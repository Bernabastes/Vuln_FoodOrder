services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    ports:
      - "5001:5001"
    volumes:
      - ./uploads:/app/uploads
    env_file:
      - .env
    environment:
      FLASK_ENV: development
      FLASK_DEBUG: "1"
      SECRET_KEY: ${SECRET_KEY}
      DATABASE_URL: ${DATABASE_URL}
      DATABASE_PATH: ${DATABASE_PATH}
      UPLOAD_FOLDER: ${UPLOAD_FOLDER}
      CLOUDINARY_CLOUD_NAME: ${CLOUDINARY_CLOUD_NAME}
      CLOUDINARY_API_KEY: ${CLOUDINARY_API_KEY}
      CLOUDINARY_API_SECRET: ${CLOUDINARY_API_SECRET}
      CHAPA_SECRET_KEY: ${CHAPA_SECRET_KEY}
      CHAPA_PUBLIC_KEY: ${CHAPA_PUBLIC_KEY}
      FRONTEND_BASE_URL: ${FRONTEND_BASE_URL}
      BACKEND_BASE_URL: ${BACKEND_BASE_URL}
    restart: unless-stopped
    command: python backend/app.py

  frontend:
    build:
      context: frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_BASE=http://localhost:5001
      - INTERNAL_API_BASE=http://backend:5001
    depends_on:
      - backend
